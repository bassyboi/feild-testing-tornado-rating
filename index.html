<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Effective Wind (Knots) vs Tilt Angle</title>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Chart.js Annotation Plugin -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background-color: #f0f8ff;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    h1, h2 {
      text-align: center;
      color: #333;
    }
    .info {
      background-color: #fff8dc;
      border: 1px solid #f4e1a1;
      border-radius: 6px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .chart-container {
      margin-top: 2rem;
    }
    .note {
      font-style: italic;
      color: #555;
      margin-bottom: 1rem;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Supercell Effective Wind vs Tilt Angle</h1>
    <div class="info">
      <h2>Overview</h2>
      <p>
        This chart shows how the <strong>effective advective wind</strong> 
        <em>(\(U_\mathrm{eff}\))</em> changes with <strong>tilt angle</strong> 
        for various <strong>CAPE</strong> values.
      </p>
      <p>
        We calculate:
        <br>
        <em>Updraft speed:</em> \( w = \sqrt{2 \times \mathrm{CAPE}} \) (m/s)
        <br>
        <em>Effective wind:</em> \( U_\mathrm{eff} = w \times \tan(\theta) \) (m/s),
        converted to <strong>knots</strong>.
      </p>
      <p>
        The shaded region between <strong>10°</strong> and <strong>20°</strong> 
        is considered a <em>"danger zone"</em> for tornado development.
      </p>
    </div>

    <div class="note">
      CAPE values plotted: 0, 1000, 2000, 3000, 4000 J/kg. Tilt angle from 0° to 30°.
    </div>

    <div class="chart-container">
      <canvas id="tiltChart" width="800" height="400"></canvas>
    </div>
  </div>

  <script>
    // ------------------------------------------
    // Constants & Conversions
    // ------------------------------------------
    const KNOTS_PER_M_S = 1.94384; // 1 m/s ≈ 1.94384 knots
    const CAPE_VALUES = [0, 1000, 2000, 3000, 4000]; // J/kg
    const TILT_MIN = 0;     // degrees
    const TILT_MAX = 30;    // degrees
    const TILT_STEP = 1;    // step in degrees

    // ------------------------------------------
    // Calculation Functions
    // ------------------------------------------
    function calcUpdraftSpeed(cape) {
      // w (m/s) = sqrt(2 × CAPE)
      return Math.sqrt(2 * cape);
    }

    function calcUeffKnots(cape, tiltDeg) {
      // w in m/s
      const w_m_s = calcUpdraftSpeed(cape);
      // tilt angle in radians
      const tiltRad = tiltDeg * (Math.PI / 180);
      // U_eff in m/s
      const Ueff_m_s = w_m_s * Math.tan(tiltRad);
      // convert to knots
      return Ueff_m_s * KNOTS_PER_M_S;
    }

    // ------------------------------------------
    // Prepare Data for Chart.js
    // ------------------------------------------
    // We'll create multiple datasets (one for each CAPE),
    // each showing U_eff in knots vs tilt angle.
    const labels = [];
    for (let t = TILT_MIN; t <= TILT_MAX; t += TILT_STEP) {
      labels.push(t);
    }

    const datasets = CAPE_VALUES.map((cape, index) => {
      const dataPoints = labels.map(tilt => calcUeffKnots(cape, tilt));
      return {
        label: `CAPE = ${cape} J/kg`,
        data: dataPoints,
        fill: false,
        borderColor: getRandomColor(index),
        borderWidth: 2
      };
    });

    // A simple helper function to generate distinct colors
    function getRandomColor(i) {
      const colorList = [
        'rgba(255, 99, 132, 1)',  // pinkish red
        'rgba(54, 162, 235, 1)',  // blue
        'rgba(255, 206, 86, 1)',  // yellow
        'rgba(75, 192, 192, 1)',  // teal
        'rgba(153, 102, 255, 1)'  // purple
      ];
      // cycle through colors
      return colorList[i % colorList.length];
    }

    // ------------------------------------------
    // Initialize Chart
    // ------------------------------------------
    window.addEventListener('DOMContentLoaded', () => {
      const ctx = document.getElementById('tiltChart').getContext('2d');
      
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: datasets
        },
        options: {
          responsive: true,
          scales: {
            x: {
              title: { display: true, text: 'Tilt Angle (°)' },
              min: TILT_MIN,
              max: TILT_MAX
            },
            y: {
              title: { display: true, text: 'Effective Wind (knots)' },
              beginAtZero: true
            }
          },
          plugins: {
            legend: { display: true },
            annotation: {
              annotations: {
                dangerZone: {
                  type: 'box',
                  xMin: 10,
                  xMax: 20,
                  yMin: 0,
                  yMax: 'max',    // shade all the way to the top
                  backgroundColor: 'rgba(255, 0, 0, 0.1)',
                  borderWidth: 0
                }
              }
            }
          }
        }
      });
    });
  </script>
</body>
</html>
